{% extends "admin/base.html" %}

{% block title %}Configuracoes de IA{% endblock %}

{% block breadcrumb %}
<span>/</span>
<span class="current">Configuracoes de IA</span>
{% endblock %}

{% block content %}
<div class="admin-page-header">
    <div class="admin-page-header-left">
        <h1 class="admin-page-title">Configuracoes de IA</h1>
        <p class="admin-page-subtitle">Configure provedores, modelos e prompts para cada caso de uso</p>
    </div>
</div>

<!-- Provider/Model Info -->
<div class="admin-card" style="margin-bottom: 1.5rem; background: var(--admin-bg-tertiary);">
    <div style="display: flex; align-items: center; gap: 1rem;">
        <span style="font-size: 2rem;">ü§ñ</span>
        <div>
            <strong>OpenAI GPT-5 Nano</strong>
            <br>
            <small style="color: var(--admin-text-muted);">
                Modelo ultra-rapido e economico ($0.05/1M input, $0.40/1M output).
                <a href="https://platform.openai.com/docs/models/gpt-5-nano" target="_blank" style="color: var(--admin-primary);">Ver documentacao</a>
            </small>
        </div>
    </div>
</div>

<!-- Filtros -->
<div class="admin-card" style="margin-bottom: 1.5rem;">
    <form method="GET" action="/admin/ai-configs" style="display: flex; gap: 1rem; flex-wrap: wrap; align-items: flex-end;">
        <div class="admin-form-group" style="margin-bottom: 0; min-width: 150px;">
            <label for="entity" class="admin-form-label">Entidade</label>
            <select id="entity" name="entity" class="admin-form-select">
                <option value="">Todas</option>
                {% for entity in entities %}
                <option value="{{ entity }}" {% if selected_entity == entity %}selected{% endif %}>
                    {{ entity|title }}
                </option>
                {% endfor %}
            </select>
        </div>
        <div class="admin-form-group" style="margin-bottom: 0; min-width: 200px;">
            <label for="use_case" class="admin-form-label">Caso de Uso</label>
            <select id="use_case" name="use_case" class="admin-form-select">
                <option value="">Todos</option>
                {% for uc in use_cases %}
                <option value="{{ uc }}" {% if selected_use_case == uc %}selected{% endif %}>
                    {{ uc }}
                </option>
                {% endfor %}
            </select>
        </div>
        <button type="submit" class="admin-btn admin-btn-primary">Filtrar</button>
        {% if selected_entity or selected_use_case %}
        <a href="/admin/ai-configs" class="admin-btn admin-btn-secondary">Limpar</a>
        {% endif %}
    </form>
</div>

<!-- Lista de Configs -->
<div class="admin-card">
    <table class="admin-table">
        <thead>
            <tr>
                <th>Entidade</th>
                <th>Caso de Uso</th>
                <th>Nome</th>
                <th>Provedor / Modelo</th>
                <th>Temp.</th>
                <th>Status</th>
                <th>Acoes</th>
            </tr>
        </thead>
        <tbody>
            {% for config in configs %}
            <tr>
                <td>
                    {% set entity_colors = {'post': 'primary', 'category': 'info', 'occasion': 'warning', 'product': 'success', 'general': 'secondary'} %}
                    {% set entity_icons = {'post': 'üìù', 'category': 'üìÅ', 'occasion': 'üéÅ', 'product': 'üì¶', 'general': '‚öôÔ∏è'} %}
                    {% set entity_value = config.entity.value if config.entity else 'general' %}
                    <span class="admin-badge admin-badge-{{ entity_colors.get(entity_value, 'secondary') }}" title="{{ entity_value|title }}">
                        {{ entity_icons.get(entity_value, '‚öôÔ∏è') }} {{ entity_value|title }}
                    </span>
                </td>
                <td>
                    <code class="admin-code">{{ config.use_case.value }}</code>
                </td>
                <td>
                    <strong>{{ config.name }}</strong>
                    {% if config.description %}
                    <br>
                    <small style="color: var(--admin-text-muted);">{{ config.description[:50] }}{% if config.description|length > 50 %}...{% endif %}</small>
                    {% endif %}
                </td>
                <td>
                    <span class="admin-badge admin-badge-{{ 'primary' if config.provider.value == 'openrouter' else 'secondary' }}">
                        {{ config.provider.value }}
                    </span>
                    <br>
                    <small>{{ config.model[:30] }}{% if config.model|length > 30 %}...{% endif %}</small>
                </td>
                <td>{{ config.temperature }}</td>
                <td>
                    {% if config.is_active %}
                    <span class="admin-badge admin-badge-success">Ativo</span>
                    {% else %}
                    <span class="admin-badge admin-badge-secondary">Inativo</span>
                    {% endif %}
                </td>
                <td>
                    <a href="/admin/ai-configs/{{ config.id }}" class="admin-btn admin-btn-sm admin-btn-secondary">
                        Editar
                    </a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="7" class="admin-empty-state">
                    Nenhuma configuracao encontrada.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Help -->
<div class="admin-card" style="margin-top: 1.5rem;">
    <h3 style="margin-bottom: 1rem;">Casos de Uso por Entidade</h3>

    <h4 style="margin: 1.5rem 0 0.75rem; color: var(--admin-primary);">üìù Post</h4>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem;">
        <div>
            <strong>post_seo_keyword</strong>
            <p style="color: var(--admin-text-muted); font-size: 0.875rem;">
                Gera a palavra-chave foco para o post baseado no titulo, subtitulo e conteudo.
            </p>
        </div>
        <div>
            <strong>post_seo_title</strong>
            <p style="color: var(--admin-text-muted); font-size: 0.875rem;">
                Gera titulo SEO otimizado (max 60 caracteres).
            </p>
        </div>
        <div>
            <strong>post_seo_description</strong>
            <p style="color: var(--admin-text-muted); font-size: 0.875rem;">
                Gera meta description (120-160 caracteres).
            </p>
        </div>
        <div>
            <strong>post_tags</strong>
            <p style="color: var(--admin-text-muted); font-size: 0.875rem;">
                Gera 3-5 tags relevantes para o post.
            </p>
        </div>
        <div>
            <strong>post_seo_all</strong>
            <p style="color: var(--admin-text-muted); font-size: 0.875rem;">
                Gera todos os campos SEO + tags em uma unica chamada (JSON).
            </p>
        </div>
    </div>

    <h4 style="margin: 1.5rem 0 0.75rem; color: var(--admin-text-muted);">‚öôÔ∏è Generico (retrocompatibilidade)</h4>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem;">
        <div>
            <strong>seo_title / seo_description / seo_keywords</strong>
            <p style="color: var(--admin-text-muted); font-size: 0.875rem;">
                Prompts genericos usados por categorias e ocasioes. Serao substituidos por prompts especificos no futuro.
            </p>
        </div>
        <div>
            <strong>product_description</strong>
            <p style="color: var(--admin-text-muted); font-size: 0.875rem;">
                Gera descricoes curtas e longas para produtos de afiliados.
            </p>
        </div>
    </div>
</div>

<!-- Placeholders Info -->
<div class="admin-card" style="margin-top: 1rem;">
    <h3 style="margin-bottom: 1rem;">Placeholders Disponiveis</h3>
    <p style="color: var(--admin-text-muted); font-size: 0.875rem; margin-bottom: 1rem;">
        Use estes placeholders no system_prompt para incorporar o contexto do conteudo:
    </p>
    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
        <code class="admin-code">{{title}}</code>
        <code class="admin-code">{{subtitle}}</code>
        <code class="admin-code">{{content}}</code>
        <code class="admin-code">{{keywords}}</code>
        <code class="admin-code">{{category}}</code>
        <code class="admin-code">{{product_name}}</code>
    </div>
</div>
{% endblock %}
